<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <style>

    *{
      -webkit-user-select:none;
    }

    .player-timedtext span{
      cursor: default;
    }

  </style>
</head>



<body>
  <!-- Netflix subtilte simulation -->
  <div class="player-timedtext">
    <div class="player-timedtext-text-container"><span>Dan Foxworthy is, like,</span></div>
    <div class="player-timedtext-text-container"><span>the super-exclusive</span></div>
  </div>

  <script src="http://localhost:4500/livereload.js" charset="utf-8"></script>
  <script src="bower_components/jquery/dist/jquery.min.js" charset="utf-8"></script>

  <script>
    $('.player-timedtext').mouseenter(function(e){
      var children = $(this).children();
      var counter = 0;

      children.each(function (index,element) {
        var spanChild = $(this).children('span');
        var newText = replace(spanChild.text());

        spanChild.html(newText);
      });

      $(this).off('mouseenter');
      activeEvents();

      function replace (text){
        var regex = /((?:\b(=?[,\.\?]?\s+|\w+)\b)|[\?\.\,])/g;
        var newText = text.replace(regex, function(match){
          counter++;
          return '<span class=\'match\' id=\'item-'+counter+'\' data-offset=\'' + counter + '\'>' + match + '</span>';
        });
        return newText;
      }

      function activeEvents(argument) {
        var startPoint, endPoint, isMouseDown = false, start, end;

        $('.match').on({
          mousedown: function(){
            isMouseDown = true;
            startPoint = $(this).data('offset');
          },
          mouseenter: function(){
            if(isMouseDown){
              endPoint = $(this).data('offset');
            }

            start = startPoint ? startPoint : $(this).data('offset');
            end = endPoint ? endPoint : start;

            if((end-start) < 0){
              var changed = changePosition(start, end);
              start = changed['start'];
              end = changed['end'];
            }

            color(start, end);

          },
          mouseleave: function(){
            if(!isMouseDown){
              discolorAll();
            }
          }
        });

        $(window).mouseup(function(){
          restartVariables();
          discolorAll();

          var text = getText(start, end);

        });

        function getText(start, end){
          var text='';
          for(var i = start; i <= end; i++){
            text += $('#item-'+i).text();
          };
          return text;
        }

        function restartVariables (){
          startPoint = endPoint = null;
          isMouseDown = false;
        }

        function color(start, end){
          discolorAll();

          for (var i = start; i <= end; i++) {
            $('#item-'+i).css({
              'background':'blue',
              'color':'white'
            });
          }

        }

        function discolorAll(){
          $('.player-timedtext *').css({
            'background':'none',
            'color': 'black'
          })
        }

        function changePosition(start, end) {
          var copy = start;

          start = end;
          end = copy;

          return {"start": start, "end": end}
        }

      }
    });


  </script>
</body>

</html>
